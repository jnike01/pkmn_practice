mapscripts TestTown_MapScripts{
    MAP_SCRIPT_ON_TRANSITION: TestTown_DefaultScript_DefaultState
}

script TestTown_DefaultScript_DefaultState{
    if(!(flag(FLAG_SYS_POKEMON_GET))){
        setvar(VAR_TEST_TOWN_STATE, 0)
    }

    call_if_unset(FLAG_RIVAL_BATTLE_CONTROL, TestTown_ControlScript_RivalBattleSetup)
}

script TestTown_Signscript_Player_House{
    lock
    msgbox("{PLAYER}{KUN}'s House")
    release
    end
}

script TestTown_Signscript_Rival_House{
    lock
    msgbox("Professor's House")
    release
    end
}

script TestTown_Signscript_Prof_Lab{
    lock
    msgbox("Professor's Lab")
    release
    end
}

script TestTown_Signscript_Gym{
    lock
    msgbox("Test Town Pokemon Gym\nLeader: Zackary\p“The wise man of iron!”")
    release
    end
}

script TestTown_ItemScript_BallOne{
    lock
    giveitem(ITEM_EVERSTONE, 1)
    removeobject(3)
    release
    end
}

script TestTown_ItemScript_BallTwo{
    lock
    giveitem(ITEM_RARE_CANDY, 1)
    removeobject(4)
    release
    end
}

script TestTown_PersonScript_NPC1{
    lock
    faceplayer
    msgbox(format("This town is so beautiful and calming. I'm visiting from out of town and this place is great. I might want to move here!"))
    release
    end
}

script TestTown_ControlScript_RivalBattleSetup{
    if(!(flag(FLAG_SYS_POKEMON_GET))){
        setflag(FLAG_RIVAL_BATTLE_ONE)
    }
    else{
        clearflag(FLAG_RIVAL_BATTLE_ONE)
    }
}

script TestTown_TrainerScript_RivalBattleOne{
    trainerbattle_single(TRAINER_RED, TestTown_TextScript_RivalIntro, TestTown_TextScript_RivalOutro, TestTown_SequenceScript_RivalLeave)
    end
}

script TestTown_SequenceScript_RivalLeave{
    msgbox(TestTown_TextScript_RivalBattleAftermath)
    closemessage
    lockall
    applymovement(6, TestTown_MovementScript_RivalLeaveAfterBattle)
    waitmovement(0)
    removeobject(6)
    setflag(FLAG_RIVAL_BATTLE_ONE)
    releaseall
}

script TestTown_TriggerScript_BlockPath{
    lockall
    msgbox("Mother said to visit the Professor and\nyour Rival before heading out!")
    applymovement(OBJ_EVENT_ID_PLAYER, TestTown_MovementScript_StopPlayer)
    waitmovement(0)
    releaseall
}

script TestTown_TriggerScript_GotoRival{
    lockall
    msgbox("You should go visit your rival first!")
    applymovement(OBJ_EVENT_ID_PLAYER, TestTown_MovementScript_StopPlayerLab)
    waitmovement(0)
    releaseall
}

movement TestTown_MovementScript_StopPlayer{
    walk_up
}

movement TestTown_MovementScript_StopPlayerLab{
    walk_right
}

movement TestTown_MovementScript_RivalLeaveAfterBattle{
    walk_right * 6
    walk_down * 7
}

text TestTown_TextScript_RivalIntro{
    "Placeholder text"
}

text TestTown_TextScript_RivalOutro{
    "Placeholder text"
}

text TestTown_TextScript_RivalBattleAftermath{
    "Placeholder text"
}
